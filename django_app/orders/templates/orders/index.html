<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Monitoramento de Pedidos - WebSocket</title>
    <style>
        body { 
          font-family: Arial, sans-serif; 
          margin: 40px; 
          background: #f5f5f5; 
        }

        h1 { 
          color: #333; 
        }
        
        #messages { 
          background: white; 
          padding: 20px; 
          border-radius: 10px; 
          min-height: 200px; 
          margin-bottom: 20px; 
        }

        .card-pedido {
          border: 1px solid #ccc;
          border-radius: 8px;
          padding: 12px;
          margin-bottom: 12px;
          background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>ðŸ“¡ Monitoramento de Pedidos</h1>

    <div id="messages"></div>

    <script>
        let socket;
        let isConnected = false;
        let sendQueue = [];
      
        function connectSocket() {
          socket = new WebSocket('ws://' + window.location.host + '/ws/orders/');
      
          socket.onopen = function () {
            console.log('WebSocket aberto');
            isConnected = true;
          };
      
          socket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            const div = document.createElement("div");
            div.classList.add("card-pedido");
            div.innerHTML = data.message;
            document.getElementById("messages").appendChild(div);
          };
      
          socket.onclose = function (e) {
            console.log('WebSocket fechado, tentando reconectar em 2s', e);
            isConnected = false;

            const div = document.createElement('div');
            div.classList.add("card-pedido");
            div.innerHTML = "<em>ConexÃ£o encerrada. Tentando reconectar...</em>";
            document.getElementById("messages").appendChild(div);
      
            setTimeout(() => {
              connectSocket();
            }, 2000);
          };
      
          socket.onerror = function (err) {
            console.error('WebSocket erro:', err);
          };
        }
        connectSocket();
    </script>
</body>
</html>
